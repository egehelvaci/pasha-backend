generator client {
  provider      = "prisma-client-js"
  output        = "../generated/prisma"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model UserType {
  id    Int    @id @default(autoincrement())
  name  String @unique
  users User[]
}

model User {
  email       String   @unique
  name        String
  createdAt   DateTime @default(now()) @map("created_at")
  credit      Decimal  @default(0) @db.Decimal(10, 2)
  debit       Decimal  @default(0) @db.Decimal(10, 2)
  isActive    Boolean  @default(true) @map("is_active")
  password    String
  phoneNumber String?  @map("phone_number")
  surname     String
  userId      String   @id @default(uuid()) @map("user_id")
  username    String   @unique
  userTypeId  Int      @map("user_type_id")
  store_id    String?  @db.Uuid
  userType    UserType @relation(fields: [userTypeId], references: [id])
  Store       Store?   @relation(fields: [store_id], references: [store_id], onUpdate: NoAction, map: "fk_user_store")
}

model Collection {
  collectionId    String            @id @default(uuid()) @map("collection_id")
  name            String
  description     String?
  code            String            @unique
  isActive        Boolean           @default(true) @map("is_active")
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @updatedAt @map("updated_at")
  PriceListDetail PriceListDetail[]
  products        Product[]
}

model Product {
  productId       String     @id @default(uuid()) @map("product_id")
  name            String
  description     String
  stock           Int
  width           Float
  height          Float
  cut             Boolean
  productImage    String?    @map("product_imageurl")
  collectionId    String     @map("collection_id")
  createdAt       DateTime   @default(now()) @map("created_at")
  updatedAt       DateTime   @updatedAt @map("updated_at")
  collection_name String?    @db.VarChar(255)
  collection      Collection @relation(fields: [collectionId], references: [collectionId])
}

model PriceList {
  price_list_id   String            @id @default(dbgenerated("gen_random_uuid()"))
  name            String            @db.VarChar(255)
  description     String?
  is_default      Boolean           @default(false)
  valid_from      DateTime?         @db.Timestamp(6)
  valid_to        DateTime?         @db.Timestamp(6)
  limit_amount    Decimal?          @db.Decimal(10, 2)
  currency        String            @db.VarChar(3)
  is_active       Boolean           @default(true)
  created_at      DateTime          @default(now()) @db.Timestamp(6)
  updated_at      DateTime          @default(now()) @db.Timestamp(6)
  PriceListDetail PriceListDetail[]
  StorePriceList  StorePriceList[]
}

model PriceListDetail {
  price_list_detail_id   String     @id @default(dbgenerated("gen_random_uuid()"))
  price_list_id          String
  collection_id          String
  price_per_square_meter Decimal    @db.Decimal(10, 2)
  created_at             DateTime   @default(now()) @db.Timestamp(6)
  updated_at             DateTime   @default(now()) @db.Timestamp(6)
  Collection             Collection @relation(fields: [collection_id], references: [collectionId], onDelete: NoAction, onUpdate: NoAction)
  PriceList              PriceList  @relation(fields: [price_list_id], references: [price_list_id], onDelete: NoAction, onUpdate: NoAction)
}

model Store {
  store_id            String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  kurum_adi           String           @db.VarChar(255)
  vergi_numarasi      String?          @db.VarChar(20)
  vergi_dairesi       String?          @db.VarChar(100)
  yetkili_adi         String?          @db.VarChar(100)
  yetkili_soyadi      String?          @db.VarChar(100)
  telefon             String?          @db.VarChar(20)
  eposta              String?          @db.VarChar(255)
  adres               String?
  faks_numarasi       String?          @db.VarChar(20)
  aciklama            String?
  limitsiz_acik_hesap Boolean?         @default(false)
  acik_hesap_tutari   Decimal?         @default(0) @db.Decimal(15, 2)
  is_active           Boolean?         @default(true)
  created_at          DateTime?        @default(now()) @db.Timestamp(6)
  updated_at          DateTime?        @default(now()) @db.Timestamp(6)
  StorePriceList      StorePriceList[]
  User                User[]
}

model StorePriceList {
  store_price_list_id String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  store_id            String    @db.Uuid
  price_list_id       String
  created_at          DateTime? @default(now()) @db.Timestamp(6)
  updated_at          DateTime? @default(now()) @db.Timestamp(6)
  PriceList           PriceList @relation(fields: [price_list_id], references: [price_list_id], onDelete: Cascade)
  Store               Store     @relation(fields: [store_id], references: [store_id], onDelete: Cascade)

  @@unique([store_id, price_list_id])
}

enum Currency {
  TRY
  USD
  EUR
}
